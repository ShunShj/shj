<!DOCTYPE html>
<html>
<head>
    {include file='public/head' /}
    <title>{$language_tag.index_product_ShowPlanTour_addingTeamProducts}</title>
    <style>
        .text_align {
            text-align: right;
            padding-right: 20px;
            vertical-align:middle;
            line-height: 38px;
        }
        .layui-btn+.layui-btn{
            margin-left:0px;
        }
        .ke-inline{
            display: inline-block;
            padding: 9px 0!important;
            line-height: 20px;
        }
        .icon-close{
            display: none;
        }
    </style>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">

    <div class="layui-header">
        {include file='public/header' /}
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            {include file='public/left_menu_web' /}
        </div>
    </div>

    <div class="layui-body">

        <!-- 内容主体区域 -->
        <div style="padding: 15px; background: #F4F4F4;">
            <div class='layui-row'>
		   		<span class="layui-breadcrumb" lay-separator="-">
                    <a>{$language_tag.index_public_homepage}</a>
                    <a>旅游产品</a>
					<a>旅游产品管理</a>
                    <a><cite>添加旅游产品</cite></a>
				</span>
            </div>

            <form class="layui-form" id="form1" onSubmit="return add()">


                <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">

                    <div class="layui-tab-content">
                        <!--基本信息-->
                        <div class="layui-tab-item layui-show" style="background: #fff; padding: 15px;  margin-bottom: 50px;">
                            <div class="layui-row" >
                                <div class="layui-col-md2 text_align input-required">{$language_tag.index_product_showRouteTemplateManage_title}:</div>
                                <div class="layui-col-md6">
                                    <div class="layui-form-item">
                                        <input data-tabs="0" type="text"  class="layui-input" required lay-verify="required" name="product[title]" />
                                    </div>
                                </div>
                            </div>
                            <div class="layui-row">
                                <div class="layui-col-md2 text_align">{$language_tag.index_product_showRouteTemplateManage_sort}:</div>
                                <div class="layui-col-md6">
                                    <div class="layui-form-item">
                                        <input data-tabs="0" type="number" class="layui-input" name="product[sorting]" /><span>说明：产品排序号越小越排前</span>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-row">
                                <div class="layui-col-md2 text_align">标签:</div>
                                <div class="layui-col-md6">
                                    <div class="layui-form-item">
                                        <input data-tabs="0" type="text" class="layui-input" name="product[product_tag]" />
                                    </div>
                                </div>
                            </div>
                            <div class="layui-row">
                                <div class="layui-col-md2 text_align input-required">分类:</div>
                                <div class="layui-col-md6">
                                    <div class="layui-form-item">
                                        <select  data-tabs="0"  class="use_company_id" name="product[type_ids]" lay-verify="required" xm-select="use_company_id" xm-select-search="" xm-select-search-type="dl">
                                            <option></option>
                                            {foreach $type_list as $vl}
                                            <option value="{$vl.ota_product_type_id}"><?= str_repeat('-------', $vl['level'])?>{$vl.type_name}</option>
                                            {/foreach}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-row">
                                <div class="layui-col-md2 text_align">目的地:</div>
                                <div class="layui-col-md6">
                                    <div class="layui-form-item" id="destination">

                                    </div>
                                </div>
                            </div>
                            <div class="layui-row">
                                <div class="layui-col-md2 text_align">景点:</div>
                                <div class="layui-col-md6">
                                    <div class="layui-form-item" id="scenic_spot">

                                    </div>
                                </div>
                            </div>
                            <div class="layui-row">
                                <div class="layui-col-md2 text_align">可见性:</div>
                                <div class="layui-col-md6">
                                    <div class="layui-form-item">
                                        <select  data-tabs="0"  name="product[visibility]" class="settlement_type" lay-verify="required">
                                            <option value="1">全可见</option>
                                            <option value="2">仅直客可见</option>
                                            <option value="2">仅代理可见</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-row">
                                <div class="layui-col-md2 text_align">状态:</div>
                                <div class="layui-col-md6">
                                    <div class="layui-form-item">
                                        <select  data-tabs="0"  name="product[status]" class="settlement_type" lay-verify="required">
                                            <option value="1">{$language_tag.index_public_show}</option>
                                            <option value="0">{$language_tag.index_public_disabled}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="layui-row">
                                <div class="layui-col-md2 text_align">样式:</div>
                                <div class="layui-col-md6">
                                    <select name="" class="layui-select">
                                        <option value="1">默认</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!--规格-->
                        <div class="layui-tab" lay-filter="demo" lay-allowclose="true">
                                <ul class="layui-tab-title" style="display: inline-block;">
                                    <li class="layui-this" style="background: #fff;">规格</li>
                                </ul>
                                <a class="layui-btn nav-add site-demo-active" data-type="tabAdd">新增规格</a>
                                <div class="layui-tab-content" style="background: #fff; padding-top: 15px;">
                                    <div class="layui-tab-item layui-show">
                                        <div>
                                            <div class="layui-col-md10">
                                                <div class="layui-form-item">
                                                    <label class="layui-form-label input-required">规格名称:</label>
                                                    <div class="layui-input-block layui-form">
                                                        <input class="layui-input" type="text" name="spec[product_specifications_name][]"  lay-verify="required"/>
                                                        <input type="hidden" name="spec[spec_uuid][]" class="spec_uuid" value="">
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="layui-row">
                                                <a class="layui-btn nav-add layui-btn-sm" onclick="addProduct(this)">添加产品</a>
                                            </div>
                                            <div class="teamProduct">
                                                <table class="layui-table">
                                                    <thead>
                                                    <tr>
                                                        <th>编号</th>
                                                        <th>名称</th>
                                                        <th>价格</th>
                                                        <th>自费项目</th>
                                                        <th>操作</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody class="productList">

                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        <div style="background: #fff; padding-top: 15px; margin-top: 50px;">

                            <!--设置附件-->
                            <div class="layui-row uploadFile">
                                <label class="layui-form-label">附件:</label>
                                <div class="layui-col-md8">
                                    <div class="layui-form-item">
                                        <input type="hidden" id="filesAnnex" class="layui-input" name="info[annex_url]" />
                                        <button type="button" class="layui-btn nav-look" id="uploadAnnex">
                                            <i class="layui-icon">&#xe67c;</i>选择文件
                                        </button>
                                        <span id="annexText">未选择任何文件</span>
                                    </div>
                                </div>
                            </div>

                            <!--设置视频-->
                            <div class="layui-row uploadFile">
                                <label class="layui-form-label">视频:</label>
                                <div class="layui-col-md8">
                                    <div class="layui-form-item">
                                        <input type="text" id="filesVideo" class="layui-input" name="info[video_urls][]" />
                                        <button type="button" class="layui-btn nav-look" id="uploadVideo">
                                            <i class="layui-icon">&#xe67c;</i>本地上传
                                        </button>
                                        支持嵌入youtube链接，或本地上传
                                    </div>
                                </div>
                            </div>

                            <!--设置图片-->
                            <div class="layui-row uploadFile">
                                <label class="layui-form-label input-required">设置图片:</label>
                                <div class="layui-col-md8">
                                    <div class="layui-form-item">
                                        <button type="button" class="layui-btn nav-look" id="uploadFile">
                                            <i class="layui-icon">&#xe67c;</i>选择文件
                                        </button>
                                        <button type="button" class="layui-btn" id="pool">
                                            <i class="layui-icon">&#xe67c;</i>媒体库
                                        </button>
                                    </div>
                                    <div id="files" style="padding: 10px">
                                    </div>
                                </div>
                            </div>


                            <!--设置地图-->
                            <div class="layui-row uploadFile">
                                <label class="layui-form-label input-required">地图:</label>
                                <div class="layui-col-md8">
                                    <div class="layui-form-item">
                                        <button type="button" class="layui-btn nav-look" id="uploadMap">
                                            <i class="layui-icon">&#xe67c;</i>选择文件
                                        </button>
                                        <button type="button" class="layui-btn" id="poolMap">
                                            <i class="layui-icon">&#xe67c;</i>媒体库
                                        </button>
                                    </div>
                                    <div id="filesMap" style="padding: 10px">
                                    </div>
                                </div>
                            </div>

                            <!--交通工具图标-->
                            <div class="layui-row">
                                <label class="layui-form-label">交通工具图标:</label>
                                <div class="layui-col-md8">
                                    <div class="layui-form-item">
                                        <input type="checkbox" lay-skin="primary" name="info[traffic_icon][]" title="Flight" value="1">
                                        <input type="checkbox" lay-skin="primary" name="info[traffic_icon][]" title="Cruise" value="2">
                                        <input type="checkbox" lay-skin="primary" name="info[traffic_icon][]" title="Train" value="3">
                                        <input type="checkbox" lay-skin="primary" name="info[traffic_icon][]" title="Tours" value="4">
                                    </div>
                                </div>
                            </div>


                            <!--标语-->
                            <div class="layui-row">
                                <label class="layui-form-label">标语:</label>
                                <div class="layui-col-md8">
                                    <div class="layui-form-item">
                                        <input type="text" class="layui-input" name="info[slogan]" />
                                    </div>
                                </div>
                            </div>


                            <!--航空公司图标-->
                            <div class="layui-row uploadFile">
                                <label class="layui-form-label">航空公司图标:</label>
                                <div class="layui-col-md8">
                                    <div class="layui-form-item">
                                        <button type="button" class="layui-btn nav-look" id="aviation_icon_upload">
                                            <i class="layui-icon">&#xe67c;</i>选择文件
                                        </button>
                                        只能上传两个图标
                                    </div>
                                    <div id="aviation_icon" style="padding: 10px">

                                    </div>
                                </div>
                            </div>



                            <!--产品简介-->
                            <div class="layui-row">
                                <label class="layui-form-label input-required">产品简介:</label>
                                <div class="layui-col-md8">
                                    <div class="layui-colla-item">
                                        <div class="layui-colla-content layui-show"  >
                                            <div class="layui-row">
                                                <textarea  lay-verify="required" id="demo4" name="info[product_description]" class="layui-textarea"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="layui-row">
                                <label class="layui-form-label">详细介绍:</label>
                                <div class="layui-col-md8">

                                    <!--线路详情-->
                                    <div class="layui-collapse" lay-accordion>
                                        <div class="layui-colla-item">
                                            <h2 class="layui-colla-title">线路详情</h2>
                                            <div class="layui-colla-content layui-show"  >
                                                <div class="layui-row">
                                                    <textarea id="demo3" name="info[product_content]"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <!--行程内容-->
                                    <div class="layui-collapse" lay-accordion>
                                        <div class="layui-colla-item">
                                            <h2 class="layui-colla-title">行程介绍</h2>
                                            <div class="layui-colla-content layui-show"  >
                                                <div class="layui-row">

                                                    <div class="layui-col-md2 text_align input-required">{$language_tag.index_product_showRouteTemplateManage_travelDays}:</div>
                                                    <div class="layui-col-md6">
                                                        <div class="layui-form-item">
                                                            <input id="journey-days" data-tabs="2" lay-verify="required" max="30" type="text" class="layui-input"  name="" style="width: 150px" placeholder="{$language_tag.index_product_showRouteTemplateManage_placeHoderDays}" value="{$RouteTemplate.days}">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="d_journey">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--费用明细-->
                                    <div class="layui-collapse" lay-accordion>
                                        <div class="layui-colla-item">
                                            <h2 class="layui-colla-title">费用明细</h2>
                                            <div class="layui-colla-content layui-show"  >
                                                <div class="layui-row">
                                                    <textarea id="demo2" name="product[cost_detail]" class="layui-textarea"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--订购须知-->
                                    <div class="layui-collapse" lay-accordion>
                                        <div class="layui-colla-item">
                                            <h2 class="layui-colla-title">订购须知</h2>
                                            <div class="layui-colla-content layui-show"  >
                                                <div class="layui-row">
                                                    <textarea id="demo1" name="product[ordering_information]" class="layui-textarea"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            </div>
                        </div>

                    </div>

                <!--提交-->
                <div class="layui-row">
                    <div class="all-button-center">
                        <button class="layui-btn nav-submit" lay-submit="" lay-filter="formDemo" id="language_add_button">{$language_tag.index_public_submit}
                        </button>
                        <a href="/ota_product/products" class="layui-btn layui-btn-primary">{$language_tag.index_public_back}</a>

                    </div>
                </div>
            </form>
        </div>

    <!--规格模板-->
    <div id="t_spec" style="display: none">
        <div class="layui-tab-item layui-show">
            <div>
                <div class="layui-col-md10">
                    <div class="layui-form-item">
                        <label class="layui-form-label input-required">规格名称:</label>
                        <div class="layui-input-block layui-form">
                            <input class="layui-input" type="text" name="spec[product_specifications_name][]"  lay-verify="required"/>
                            <input type="hidden" name="spec[spec_uuid][]" class="spec_uuid" value="">
                        </div>
                    </div>
                </div>

                <div class="layui-row">
                    <a class="layui-btn nav-add layui-btn-sm" onclick="addProduct(this)">添加产品</a>
                </div>
                <div class="teamProduct">
                    <table class="layui-table">
                        <thead>
                        <tr>
                            <th>编号</th>
                            <th>名称</th>
                            <th>价格</th>
                            <th>自费项目</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody class="productList">

                        </tbody>
                    </table>
                </div>

            </div>


        </div>
    </div>

    <!--航班模板-->
    <div id="t_transfer" style="display: none">
        <div  style="border: 1px solid #e8e6e6;padding: 10px;margin-top: 10px;">
            <div  class="layui-row">
                <div class="layui-col-md5">
                    <div class="layui-form-item">
                        <label class="layui-form-label">{$language_tag.index_public_flightNumber}:</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input" name="journey[flight][ii][flight_number]"/>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md5">
                    <div class="layui-form-item">
                        <label class="layui-form-label">{$language_tag.index_public_transportMachine}:</label>
                        <div class="layui-input-block">
                            <input type="radio" name="journey[flight][ii][flight_type]" value="1" title="{$language_tag.index_public_meetAirport}"  checked>
                            <input type="radio" name="journey[flight][ii][flight_type]" value="2" title="{$language_tag.index_public_giveAirport}"  >
                            <input type="radio" name="journey[flight][ii][flight_type]" value="3" title="{$language_tag.index_public_changeAirport}"  >
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-md5">
                    <div class="layui-form-item">
                        <label class="layui-form-label">{$language_tag.index_public_startPlace}:</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input" name="journey[flight][ii][start_city]" />
                        </div>
                    </div>
                </div>
                <div class="layui-col-md5">
                    <div class="layui-form-item">
                        <label class="layui-form-label">{$language_tag.index_product_showRouteTemplateManage_departureTime}:</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input fight_time_ii" name="journey[flight][ii][start_time]" placeholder="HH:mm" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-md5">
                    <div class="layui-form-item">
                        <label class="layui-form-label">{$language_tag.index_public_endPlace}:</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input " name="journey[flight][ii][end_city]"/>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md5">
                    <div class="layui-form-item">
                        <label class="layui-form-label">{$language_tag.index_public_endTime}:</label>
                        <div class="layui-input-block">
                            <input type="text" class="layui-input fight_time_ii" name="journey[flight][ii][end_time]" placeholder="HH:mm" />
                        </div>
                    </div>
                </div>
            </div>
            <input type="hidden" id="fight-the-days-ii" name="journey[flight][ii][the_days]">
            <div><button type="button" class="layui-btn layui-btn-primary r_transfer nav-edit"  >{$language_tag.index_public_del}</button></div>
        </div>
    </div>

    <!--行程信息模板-->
    <div id="t_journey" style="display: none">
        <div id="day-journey-ii" style="border: 1px solid #e8e6e6;padding: 10px;margin-top: 10px;">
            <div class="layui-row">
                <div class="layui-col-md2">DAY ii</div>
                <input type="hidden" name="journey[ii][the_days]" data-tabs="2" value="ii" />
            </div>

            <div class="layui-row">
                <div class="layui-col-md2 text_align">{$language_tag.index_public_zone}:</div>
                <div class="layui-col-md6">
                    <div class="layui-form-item">
                        <select  name="journey[ii][country_id]" data-tabs="2" lay-search>
                            <option value="">{$language_tag.index_source_showSupplier_choose_own_zone}</option>
                            {foreach name='CountryList'  item='vo'}
                            <option value="{$vo.id}" {$vo.id==$RouteJourneyV.route_journey_zone?'selected':''}>{$vo.cpc_name}</option>
                            {/foreach}
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-md2 text_align input-required">{$language_tag.index_public_travelTitle}:</div>
                <div class="layui-col-md6">
                    <div class="layui-form-item">
                        <input type="text" class="layui-input"  name="journey[ii][route_journey_title]" data-tabs="2" lay-verify="required" required>输入：[train][plane][ship][bus]  前台可替换为相应图标
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-md2 text_align input-required">{$language_tag.index_public_travelContent}:</div>
                <div class="layui-col-md6">
                    <div class="layui-form-item">
                        <textarea class="layui-textarea" name="journey[ii][route_journey_content]" data-tabs="2" lay-verify="required" required></textarea>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-md2 text_align">{$language_tag.index_public_traffic}:</div>
                <div class="layui-col-md6">
                    <div class="layui-form-item">
                        <input type="text" class="layui-input"  name="journey[ii][route_journey_traffic]">
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-md2 text_align">{$language_tag.index_public_getAccommodation}:</div>
                <div class="layui-col-md6">
                    <div class="layui-form-item">
                        <input type="text" class="layui-input"  name="journey[ii][route_journey_stay]">
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-md2 text_align">{$language_tag.index_finance_showReceivableManage_dining}:</div>
                <div class="layui-col-md6">
                    <div class="layui-row">
                        <div class="layui-form-item">
                            <div class="layui-col-md2"><input type="checkbox" name="journey[ii][eat_mark][]" title="{$language_tag.index_public_breakfast}" lay-skin="primary" value="1" ></div>
                            <div class="layui-col-md10"><input type="text" class="layui-input"  name="journey[ii][route_journey_breakfast]"></div>
                        </div>
                    </div>
                    <div class="layui-row">
                        <div class="layui-form-item">
                            <div class="layui-col-md2"><input type="checkbox" name="journey[ii][eat_mark][]" title="{$language_tag.index_public_lunch}" lay-skin="primary" value="2"></div>
                            <div class="layui-col-md10"><input type="text" class="layui-input"  name="journey[ii][route_journey_lunch]"></div>
                        </div>
                    </div>
                    <div class="layui-row">
                        <div class="layui-form-item">
                            <div class="layui-col-md2"><input type="checkbox" name="journey[ii][eat_mark][]" title="{$language_tag.index_public_dinner}" lay-skin="primary" value="3" ></div>
                            <div class="layui-col-md10"><input type="text" class="layui-input"  name="journey[ii][route_journey_dinner]"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-md2 text_align">{$language_tag.index_finance_showReceivableManage_scenic_spot}:</div>
                <div class="layui-col-md6">
                    <div class="layui-form-item">
                        <input type="text" class="layui-input"  name="journey[ii][route_journey_scenic_sport]">
                    </div>
                </div>
            </div>
            <div class="layui-row">
                <div class="layui-col-md2 text_align">{$language_tag.index_product_showRouteTemplateManage_travelImage}:</div>
                <div class="layui-col-md8">
                    <div class="layui-form-item">
                        <button type="button" class="layui-btn nav-look" id="journey-picture-ii">
                            <i class="layui-icon">&#xe67c;</i>{$language_tag.index_product_showRouteTemplateManage_uploadImage}
                        </button>
                    </div>
                    <div id="u-img-ii" style="padding: 10px">

                    </div>
                </div>
            </div>
            <!--<div class="layui-row">
                <div class="layui-col-md2 text_align">{$language_tag.index_public_mark}:</div>
                <div class="layui-col-md6">
                    <div class="layui-form-item">
                        <textarea class="layui-textarea" name="journey_remark[ii]"></textarea>
                    </div>
                </div>
            </div>-->
            <h2 class="" style="position: relative; height: 42px; line-height: 42px; padding: 0 15px 0 35px; color: #333; background-color: #f2f2f2; cursor: pointer; font-size: 14px; overflow: hidden;">{$language_tag.index_public_flightInformation}</h2>
            <div class="layui-colla-content layui-show"  >
                <div><a class="layui-btn add_transfer nav-add" data-id="ii">{$language_tag.index_public_add}</a></div>
                <div class="d_transfer_ii">
                </div>
            </div>
        </div>
    </div>


    <div class="layui-footer">
        <!-- 底部固定区域 -->
        © layui.com - 底部固定区域
    </div>
</div>

<div id="route_template_id" style="display: none">

    <div class="layui-row layui-form" style="height: 400px;padding: 20px">
        <div class="layui-col-md2 text_align">{$language_tag.index_product_showRouteTemplateManage_route_template}:</div>
        <div class="layui-col-md6">
            <div class="layui-form-item">
                <select lay-filter="s_route_template_id"   lay-search >
                    <option></option>
                    {foreach $RouteTemplateList as $RouteTemplateListV}
                    <option value="{$RouteTemplateListV.route_template_id}" {$_GET['route_template_id']==$RouteTemplateListV.route_template_id?'selected':''}>{$RouteTemplateListV.route_name}</option>
                    {/foreach}
                </select>
            </div>
        </div>
    </div>
</div>
<!--添加分公司弹出窗-->
<script id="branchPop" type="text/html">
    <form class="layui-form">
        <div class='layui-input-inline'>
            <select name="chooseCompany" id="product_type" lay-filter="product_type">
                <option value="1">{$language_tag.index_branchcompany_showBranchProductManage_branchProduct}</option>
                <option value="2">{$language_tag.index_product_showRouteTemplateManage_route_template}</option>
            </select>
        </div>

       <div class='layui-input-inline'>
            <select name="chooseCompany" id="branch_product_type_id" lay-search>

            </select>
        </div>
        <div class='layui-input-inline'>
            <input type="text" id="branch_product_number" name="source_number_search"  placeholder="{$language_tag.index_branchcompany_showBranchProductManage_number}" class="layui-input">
        </div>
        <div class='layui-input-inline'>
            <input type="text" id="branch_product_name" name="source_name_search"  placeholder="{$language_tag.index_product_PlanSuppliersPayable_name}" class="layui-input">
        </div>
        <div class='layui-input-inline'>
            <a href="javascript:void(0);" class="layui-btn nav-submit" onclick="team()">{$language_tag.index_public_search}</a>
        </div>
    </form>
    <br>
    <div class="lay-tab-box">
        <div class="table-nont">
            <table class="layui-table layui-form" id="teamTable">
                <colgroup>
                    <col width="50">
                    <col width="180">
                    <col width="180">
                    <col width="160">
                    <col width="120">
                    <col width="120">
                    <col width="120">
                </colgroup>
                <thead>
                <tr>
                    <th></th>
                    <th>编号</th>
                    <th>类型</th>
                    <th>名称</th>
                    <th>币种</th>
                    <th>直客价</th>
                    <th>代理价</th>
                    <th>线路类型</th>
                </tr>
                </thead>
                <tbody id="team_table">

                </tbody>
            </table>
        </div>
    </div>
</script>
<script id="team_table_pop" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <tr>
        <td><input type="radio" name="productCheckboxTable" lay-skin="primary"></td>
        <td><a target="_blank" href="/branchcompany/showBranchProductInfo?branch_product_number={{item.branch_product_number}}" class="table-href number sameNumber" data-route_template_id="{{item.route_teamplate_array.length >0 ? item.route_teamplate_array[0].route_template_id : ''}}" data-product_type="1" data-branch_product_id="{{item.branch_product_id}}">{{item.branch_product_number}}</a></td>
        <td class="types">{$language_tag.index_branchcompany_showBranchProductManage_branchProduct}</td>
        <td class="name">{{item.branch_product_name}}</td>
        <td>{{item.route_teamplate_array.length >0 ? item.route_teamplate_array[0].price_currency_name : ''}}</td>
        <td>{{item.customer_price}}</td>
        <td>{{item.distributor_price}}</td>
        <td>{{item.branch_product_type_name}}</td>
    </tr>
    {{#  }); }}
</script>

<script id="team_table_pop2" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <tr>
    <td><input type="radio" name="productCheckboxTable" lay-skin="primary"></td>
        <td><a target="_blank" href="/product/showRouteTemplateInfo?route_template_id={{item.route_template_id}}" class="table-href number sameNumber" data-route_template_id="{{item.route_template_id}}" data-product_type="2" data-branch_product_id="0">{{item.route_number}}</a></td>
    <td class="types">{$language_tag.index_product_showRouteTemplateManage_route_template}</td>
    <td class="name">{{item.route_name}}</td>
    <td>{{item.currency_name}}</td>
    <td>{{item.once_price}}</td>
    <td>{{item.once_price}}</td>
    <td>{{item.route_type_name}}</td>
    </tr>
        {{#  }); }}
</script>
<script id="productTr" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <tr data-parent="parent">
        <td>{{item.branch_product_number}}</td>
        <td>{{item.branch_product_name}}</td>
        <td><a class="layui-btn layui-btn-sm visitorList3 hover-edit layui-btn-primary" onclick="openTeam(this)">查看</a></td>
        <td><a class="layui-btn layui-btn-sm visitorList3 hover-edit layui-btn-primary" onclick="openSource(this)">查看</a></td>
        <td><button class="layui-btn layui-btn-sm visitorList3 hover-edit layui-btn-primary" onclick="otherDel(this)">{$language_tag.index_public_del}</button></td>
    </tr>
    {{#  }); }}
</script>-->

<script id="teamProduct" type="text/html">
    <table class="layui-table layui-form" id="">
        <thead>
        <tr>
            <th>编号</th>
            <th>发团日期</th>
            <th>币种</th>
            <th>直客价</th>
            <th>代理价</th>
        </tr>
        </thead>
        <tbody id="teamProductTable">

        </tbody>
    </table>

</script>

<script id="teamProductTr" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <tr data-parent="parent">
        <td><a target="_blank" href="/product/showPlanTourInfo?plan_id={{item.team_product_id}}" class="table-href number">{{item.team_product_number}}</a></td>
        <td>{{date('Y-m-d',item.begin_time)}}</td>
        <td>
            <select name="team_product[currency_id]" disabled="disabled" class="currency_id">
                {{#  layui.each(item.currency, function(k, v){ }}
                {{#  if(item.currency_id == v.currency_id){ }}
                <option value="{{v.currency_id}}" selected>{{v.currency_name}}</option>
                {{#  } else { }}
                <option value="{{v.currency_id}}">{{v.currency_name}}</option>
                {{#  } }}
                {{#  }); }}
            </select>
        </td>
        <td>
            {{#  if(item.customer_price){ }}
            <input class="layui-input customer_price" type="text" name="team_product[customer_price]" value="{{ item.customer_price }}">
            {{#  } else { }}
            <input class="layui-input customer_price" type="text" name="team_product[customer_price]" value="0.00">
            {{#  } }}
        </td>

        <td>
            {{#  if(item.distributor_price){ }}
            <input class="layui-input distributor_price" type="text" name="team_product[distributor_price]" value="{{ item.distributor_price }}">
            {{#  } else { }}
            <input class="layui-input distributor_price" type="text" name="team_product[distributor_price]" value="0.00">
            {{#  } }}
        </td>
    </tr>

    {{#  }); }}
</script>


<script id="teamSource" type="text/html">
    <table class="layui-table layui-form" id="">
        <thead>
        <tr>
            <th>编号</th>
            <th>发团日期</th>
            <th>自费项目名称</th>
            <th>币种</th>
            <th>直客价</th>
            <th>代理价</th>
        </tr>
        </thead>
        <tbody id="teamSourceTable">

        </tbody>
    </table>

</script>

<script id="teamSourceTr" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <tr data-parent="parent">
        <td>{{item.source_number}}</td>
        <td>{{date('Y-m-d',item.begin_time)}}</td>
        <td>{{item.source_name}}</td>
        <td>
            <select name="product_source[currency_id]" lay-verify="required" disabled="disabled" class="currency_id">
                {{#  layui.each(item.currency, function(k, v){ }}
                {{#  if(item.currency_id == v.currency_id){ }}
                <option value="{{v.currency_id}}" selected>{{v.currency_name}}</option>
                {{#  } else { }}
                <option value="{{v.currency_id}}">{{v.currency_name}}</option>
                {{#  } }}
                {{#  }); }}
            </select>
        </td>
        <td>
            {{#  if(item.customer_price){ }}
            <input class="layui-input customer_price" type="text" name="product_source[customer_price]" value="{{ item.customer_price }}">
            {{#  } else { }}
            <input class="layui-input customer_price" type="text" name="product_source[customer_price]" value="0.00">
            {{#  } }}
        </td>

        <td>
            {{#  if(item.distributor_price){ }}
            <input class="layui-input distributor_price" type="text" name="team_product[distributor_price]" value="{{ item.distributor_price }}">
            {{#  } else { }}
            <input class="layui-input distributor_price" type="text" name="team_product[distributor_price]" value="0.00">
            {{#  } }}
        </td>
    </tr>
    {{#  }); }}
</script>

<script id="destinationSpan" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <input type="checkbox" lay-skin="primary" {{ item.checked }} lay-filter="destination_uuid" name="product[destination_uuid][]" title="{{item.destination_name}}" value="{{ item.uuid }}">
    {{#  }); }}
</script>

<script id="ScenicSpotSpan" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <input type="checkbox" lay-skin="primary" {{ item.checked }} lay-filter="scenic_spot_uuid" name="product[scenic_spot_uuid][]" title="{{item.scenic_spot_name}}" value="{{ item.uuid }}">
    {{#  }); }}
</script>




{include file='public/foot_js' /}
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.2/moment.min.js"></script>
<script type="text/javascript" src="__STATIC__/javascript/data.js"></script>

<script>
    var form = layui.form;
    var laytpl=layui.laytpl;
    var addRoute=[];
    var teamPriceList = [];
    var sourcePriceList = [];
    var curreys=[];//币种
    var selectedDestination = [];
    var selectedScenicSpot = [];

    !function() {
        var layer = layui.layer;
        var form = layui.form;
        var laydate = layui.laydate;
        var upload = layui.upload;
        var imgUp = 0;
        var formSelects = layui.formSelects;
        var select = layui.select;

        form.on('select(product_type)', function () {
            getProductType();
        });

        //附件上传默认绑定
        var uploadInst = upload.render({
            elem: '#uploadAnnex' //绑定元素
            ,url: '/demo/uploadOtaFile', //上传接口
            multiple:'true',
            drag:'true'
            ,accept:'file'
            ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                layer.load(2); //上传loading
            }
            ,done: function(res){
                //上传完毕回调
                layer.closeAll('loading'); //关闭loading
                if(res.code == 200){
                    $('#filesAnnex').val(res.data);
                    $('#annexText').html(res.data);
                }
            }
            ,error: function(res){
                //请求异常回调
                layer.closeAll('loading'); //关闭loading
            }
        });

        //视频上传默认绑定
        var uploadInst = upload.render({
            elem: '#uploadVideo' //绑定元素
            ,url: '/demo/uploadOtaFile', //上传接口
            multiple:'true',
            drag:'true'
            ,accept:'video'
            ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                layer.load(2); //上传loading
            }
            ,done: function(res){
                //上传完毕回调
                layer.closeAll('loading'); //关闭loading
                if(res.code == 200){
                    $('#filesVideo').val(res.data);
                }
            }
            ,error: function(res){
                //请求异常回调

                layer.closeAll('loading'); //关闭loading
            }
        });

        //图片上传默认绑定
        var uploadInst = upload.render({
            elem: '#uploadFile' //绑定元素
            ,url: '/demo/uploadOtaFile', //上传接口
            multiple:'true',
            drag:'true'
            ,acceptMime:'image/*'
            ,accept:'images'
            ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                layer.load(2); //上传loading
            }
            ,done: function(res){
                //上传完毕回调
                layer.closeAll('loading'); //关闭loading
                if(res.code == 200){
                    var h = '<div style="padding: 5px;width: 110px;float: left" class="img_list"><div><img src="'+res.data+'" height="100" width="100" /><input type="hidden" value="'+res.data+'" name="info[image_urls][]" /></div><div><a class="layui-btn nav-edit delUpload">{$language_tag.index_public_del}</a></div></div>';
                    $('#files').append(h);
                }
            }
            ,error: function(res){
                //请求异常回调

                layer.closeAll('loading'); //关闭loading
            }
        });


        //航空公司图标上传默认绑定
        var uploadInst = upload.render({
            elem: '#aviation_icon_upload' //绑定元素
            ,url: '/demo/uploadOtaFile', //上传接口
            multiple:'true',
            drag:'true'
            ,acceptMime:'image/*'
            ,accept:'images'
            ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                layer.load(2); //上传loading
            }
            ,done: function(res){
                //上传完毕回调
                layer.closeAll('loading'); //关闭loading
                if(res.code == 200){
                    var h = '<div style="padding: 5px;width: 110px;float: left" class="img_list"><div><img src="'+res.data+'" height="100" width="100" /><input type="hidden" value="'+res.data+'" name="info[aviation_icon][]" /></div><div><a class="layui-btn nav-edit delUpload">{$language_tag.index_public_del}</a></div></div>';

                    if($('#aviation_icon .img_list').length >1) {
                        layer.msg('只能上传两个图标', {icon: 5});
                        return false;
                    }
                    $('#aviation_icon').append(h);
                }
            }
            ,error: function(res){
                //请求异常回调

                layer.closeAll('loading'); //关闭loading
            }
        });


        //地图图片上传默认绑定
        var uploadInst = upload.render({
            elem: '#uploadMap' //绑定元素
            ,url: '/demo/uploadOtaFile', //上传接口
            multiple:'true',
            drag:'true'
            ,acceptMime:'image/*'
            ,accept:'images'
            ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                layer.load(2); //上传loading
            }
            ,done: function(res){
                //上传完毕回调
                layer.closeAll('loading'); //关闭loading
                if(res.code == 200){
                    var h = '<div style="padding: 5px;width: 110px;float: left" class="img_list"><div><img src="'+res.data+'" height="100" width="100" /><input type="hidden" value="'+res.data+'" name="info[map_url]" /></div><div><a class="layui-btn nav-edit delUpload">{$language_tag.index_public_del}</a></div></div>';
                    $('#filesMap').html(h);
                }
            }
            ,error: function(res){
                //请求异常回调

                layer.closeAll('loading'); //关闭loading
            }
        });

        $.ajax({
            type: "post",
            url: "/system/getCurrencyAjax",
            data: {
                company_order_number:(window.location.search).split("=")[1]
            },
            dataType: "json",
            success: function (result) {

                if(result.code==200) {
                    curreys = result.data;
                    form.render();
                }else if(result.code!=200){
                    return false;
                }
            }
        });

        //删除图片
        $('.uploadFile').delegate('.delUpload','click',function(){
            $(this).parent().parent().remove();
        });


        //图片上传默认绑定
        for(var i=1;i<=imgUp;i++){
            var uploadInst = upload.render({
                elem: '#journey-picture-'+i //绑定元素
                ,url: '/demo/uploadFile?day='+i, //上传接口
                multiple:'true',
                drag:'true'
                ,acceptMime:'image/*'
                ,accept:'images'
                ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                    layer.load(2); //上传loading
                }
                ,done: function(res){
                    //上传完毕回调

                    layer.closeAll('loading'); //关闭loading
                    if(res.code == 200){
                        var h = '<div style="padding: 5px;width: 110px;float: left"><div><img src="'+res.data+'" height="100" width="100" /><input type="hidden" value="'+res.data+'" name="journey['+res.get.day+'][route_journey_picture][]" /></div><div><a class="layui-btn layui-btn-danger r-journey-img nav-edit">{$language_tag.index_public_del}</a></div></div>';
                        $('#u-img-'+res.get.day).append(h);
                    }
                }
                ,error: function(res){
                    //请求异常回调

                    layer.closeAll('loading'); //关闭loading
                }
            });
        }

        //航班日期绑定
        var transfer_time_sum = 0;
        for(var ij=0;ij<transfer_time_sum;ij++){
            $('.fight_time_'+ij).each(function(){
                laydate.render({
                    elem: this
                    ,trigger: 'click'
                    ,type:'time'
                    ,format: 'HH:mm'
//              ,lang: 'en'
                });
            });
        }

        //航班信息
        var transfer_ii = 0;
        var sdays=1; //当前第几天
        var is_days = 0;
        //行程列表加载
        $('#journey-days').on('blur',function(){
            var journeyDays = $('#journey-days').val();

            if(journeyDays==''){
                return;
            }
            if(journeyDays>30){
                journeyDays=30;
                $('#journey-days').val(30);
            }

            if(journeyDays<sdays){
                var r_days =sdays-journeyDays;
                for(var ri=1;ri<=r_days;ri++){
                    $('#day-journey-'+sdays).remove();
                    sdays--;
                }
                return;
            }

            if(is_days){
                if(sdays<=0){
                    sdays=1;
                }else{
                    sdays++;
                }
            }


            for(var i=sdays;i<=journeyDays;i++){
                var html = $('#t_journey').html();
                for(var j=1;j<30;j++){
                    html = html.replace('ii',i);
                }
                $('.d_journey').append(html);
                form.render(); //重新渲染
                //图片上传
                var uploadInst = upload.render({
                    elem: '#journey-picture-'+i //绑定元素
                    ,url: '/demo/uploadFile?day='+i, //上传接口
                    multiple:'true',
                    drag:'true'
                    ,acceptMime:'image/*'
                    ,accept:'images'
                    ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                        layer.load(2); //上传loading
                    }
                    ,done: function(res){
                        //上传完毕回调
                        layer.closeAll('loading'); //关闭loading
                        if(res.code == 200){
                            var h = '<div style="padding: 5px;width: 110px;float: left"><div><img src="'+res.data+'" height="100" width="100" /><input type="hidden" value="'+res.data+'" name="journey['+res.get.day+'][route_journey_picture][]" /></div><div><a class="layui-btn layui-btn-danger r-journey-img nav-edit">{$language_tag.index_public_del}</a></div></div>';
                            $('#u-img-'+res.get.day).append(h);
                        }
                    }
                    ,error: function(res){
                        //请求异常回调
                        layer.closeAll('loading'); //关闭loading
                    }
                });
            }
            sdays = i-1;
            is_days=1;
//            alert(sdays);
        });
        //行程中添加航班
        $('.d_journey').delegate('.add_transfer','click',function(){
            var day_id = $(this).data('id');
            //          alert(day_id);

            var html = $('#t_transfer').html();
            for(var j=1;j<20;j++){
                html = html.replace('ii',transfer_ii);
            }
            $('.d_transfer_'+day_id).append(html);
            $('#fight-the-days-'+transfer_ii).val(day_id);
            //航班日期渲染
            $('.fight_time_'+transfer_ii).each(function(){
                laydate.render({
                    elem: this
                    ,trigger: 'click'
                    ,type:'time'
                    ,format: 'HH:mm'
//              ,lang: 'en'
                });
            });
            form.render();
            transfer_ii++;
        });
        //删除图片
        $('.d_journey').delegate('.r-journey-img','click',function(){
            $(this).parent().parent().remove();
        });
        //航班删除
        $('.d_journey').delegate('.r_transfer','click',function(){
            $(this).parent().parent().remove();
        });


        form.on('checkbox(destination_uuid)', function(data){
            if (data.elem.checked === true)
            {
                selectedDestination.push(data.value);
            }
            if (data.elem.checked === false)
            {
                selectedDestination.splice($.inArray(data.value,selectedDestination),1);
            }
        });

        form.on('checkbox(scenic_spot_uuid)', function(data){
            if (data.elem.checked === true)
            {
                selectedScenicSpot.push(data.value);
            }
            if (data.elem.checked === false)
            {
                selectedScenicSpot.splice($.inArray(data.value,selectedScenicSpot),1);
            }
        });


        formSelects.closed('use_company_id', function(id){
            var type_ids = $('form').find('input[name="product[type_ids]"]').val();

            $("#destination").html('');
            $("#scenic_spot").html('');
            $.ajax({
                type: "POST",
                url: '/ota_product/getDestinationAndScenicSpotByTypeIdsAjax',
                data: {
                    type_ids:type_ids
                },
                success: function (data) {
                    if(data.code!=200){
                        layer.msg('获取失败');
                    }else if(data.code==200){

                        if (data.data.destination) {
                            for (var i=0; i<data.data.destination.length; i++)
                            {
                                data.data.destination[i]['checked'] = '';
                                if ($.inArray(data.data.destination[i]['uuid'],selectedDestination) >= 0)
                                {
                                    data.data.destination[i]['checked'] = 'checked';
                                }
                            }
                            var destinationSpan = $("#destinationSpan").html();
                            laytpl(destinationSpan).render(data.data.destination, function(html) {
                                $("#destination").html(html);
                            });
                        }

                        if (data.data.scenic_spot) {

                            for (var i=0; i<data.data.scenic_spot.length; i++)
                            {
                                data.data.scenic_spot[i]['checked'] = '';
                                if ($.inArray(data.data.scenic_spot[i]['uuid'],selectedScenicSpot) >= 0)
                                {
                                    data.data.scenic_spot[i]['checked'] = 'checked';
                                }
                            }
                            var ScenicSpotSpan=$("#ScenicSpotSpan").html();
                            laytpl(ScenicSpotSpan).render(data.data.scenic_spot, function(html) {
                                $("#scenic_spot").html(html);
                            });
                        }

                        form.render();
                    }
                },
                error:function(XMLHttpRequest, textStatus, errorThrown){
                    layer.msg('{$language_tag.index_public_verificationFailure}');
                }
            });
        });


    }();

    function add() {

        if($('#files .img_list').length==0){
            layer.msg('没得图片，请找一张图片，爱你哦！', {icon: 5});
            return false;
        }

        if($('#filesMap .img_list').length==0){
            layer.msg('请上传地图', {icon: 5});
            return false;
        }

        var data = $('#form1').serializeArray();

        layer.load(2);
        $.ajax({
            type: "POST",
            url: '/ota_product/addProductAjax',
            data: data,
            success: function (data) {
                layer.closeAll();
                if(data.code!=200){
                    layer.msg(data.msg)
                    return false;
                }else if(data.code==200){
                    layer.msg('{$language_tag.index_public_success}',{time:1,end : function(layero, index){
                            //history.back(-1);
                            location.href = '/ota_product/products';
                        }
                    });
                }
            },
            error:function(XMLHttpRequest, textStatus, errorThrown){
                layer.closeAll();
                layer.msg('{$language_tag.index_public_verificationFailure}');
            }
        });
        return false;
    }


    function inArray(needle, haystack) {
        var length = haystack.length;
        for (var i = 0; i < length; i++) {
            if (haystack[i] == needle) {
                return true;
            }
        }
        return false;
    }


    function getProductType() {
        var product_type = $('#product_type').val();
        console.log(product_type);
        $.ajax({
            type: "post",
            url: "/ota_product/getProductTypeAjax",
            data:{
                product_type:product_type
            },
            dataType: "json",
            success: function (result) {
                if(result.code==200){
                    var list=result.data;
                    var branchHtml='';
                    branchHtml+='<option value="">请选择类型</option>';
                    if (product_type == 1)
                    {
                        for(var i=0;i<list.length;i++){
                            branchHtml+='<option value="'+list[i].branch_product_type_id+'">'+list[i].branch_product_type_name+'</option>';
                        }
                    }

                    if (product_type == 2)
                    {
                        for(var i=0;i<list.length;i++){
                            branchHtml+='<option value="'+list[i].route_type_id+'">'+list[i].route_type_name+'</option>';
                        }
                    }

                    $("#branch_product_type_id").html(branchHtml);
                    form.render();
                }else if(result.code!=200){
                    return false;
                }

            }
        });
    }

    function addProduct(obj) {
        team();
        var gettpl = $('#branchPop').html();
        var table = $(obj).parent('.layui-row').next('div').find('.productList');
        var spec_hidden = $(obj).parent('.layui-row').prev('div').find('.spec_uuid');

        layer.confirm(gettpl, {
            skin: 'my-skin'
            , btn: ['立即提交', '取消'] //按钮
            , title: '添加分公司产品'
            , btnAlign: 'c' //按钮居中
            , area: ['1200px', '490px']
            , shadeClose: true,
            scrollbar: false,
            success:function () {
                //获取分公司
                getProductType();
            }
        }, function () {
            addRoute=[];
            layer.load(2);
            var route_template_id;
            var branch_product_id;
            var product_type;
            $("#team_table").find('td input[type="radio"]').each(function(index, item) {
                if (item.checked === true) {
                    route_template_id = $(item).parents('td').siblings('td').find('.sameNumber').data('route_template_id');
                    branch_product_id = $(item).parents('td').siblings('td').find('.sameNumber').data('branch_product_id');
                    product_type = $(item).parents('td').siblings('td').find('.sameNumber').data('product_type');
                    if (product_type ==1 )
                    {
                        if($(item).parent("td").attr("data-old")!='old'){
                            addRoute.push({branch_product_number:productTeamPop[index].branch_product_number,branch_product_name:productTeamPop[index].branch_product_name,route_teamplate_array:productTeamPop[index].route_teamplate_array});
                        }
                    }
                    if (product_type ==2)
                    {
                        if($(item).parent("td").attr("data-old")!='old'){
                            addRoute.push({branch_product_number:productTeamPop[index].route_number,branch_product_name:productTeamPop[index].route_name,route_teamplate_array:productTeamPop[index]});
                        }
                    }

                }
            });

            if (route_template_id > 0 )
            {
                $.ajax({
                    type: "post",
                    url: "/ota_product/addSpecAjax",
                    data:{
                        branch_product_id: branch_product_id,
                        route_template_id: route_template_id,
                        product_type:product_type
                    },
                    dataType: "json",
                    success: function (result) {
                        if(result.code==200){
                            spec_hidden.val(result.data);
                            if(addRoute.length>0){
                                addproducts(table);
                            }else{
                                layer.closeAll();
                            }
                            form.render();
                        }else if(result.code!=200){
                            return false;
                        }
                    }
                });

            }


        });
    }
    //添加产品
    function addproducts(table) {
        var productTr=$("#productTr").html();
        laytpl(productTr).render(addRoute, function(html) {
            table.html(html);
        });
        layer.closeAll();
    }

    //删除其他产品
    function otherDel(obj) {
        $(obj).parents('.teamProduct').siblings('.layui-col-md10').find('.spec_uuid').val('');
        teamPriceList = [];
        sourcePriceList = [];
        $(obj).parents('.productList').html('');
    }

    /*弹窗获取分公司产品*/
    function team() {
        var branch_product_type_id=$("#branch_product_type_id").val();
        var branch_product_number=$("#branch_product_number").val();
        var branch_product_name=$("#branch_product_name").val();
        var product_type = $("#product_type").val();
        $.ajax({
            type : "post",
            url : "/ota_product/getBranchProductAjax",
            data : {
                branch_product_type_id:branch_product_type_id,
                branch_product_number:branch_product_number,
                branch_product_name:branch_product_name,
                product_type:product_type,
                is_like:1,
                status:1,
            },
            dataType : "json",
            success : function(result) {
                if(result.code==200) {
                    var addTeams = result.data;
                    productTeamPop = addTeams;
                    var tableList = $("#team_table_pop").html();
                    if (product_type == 2)
                    {
                        tableList = $("#team_table_pop2").html();
                    }
                    laytpl(tableList).render(addTeams, function (html) {
                        $("#team_table").html(html);
                        if ($(".productList").find("tr").length > 0) {
                            $(".productList").find("tr").each(function (index, item) {
                                var onNumber = $("#team_table").find(".sameNumber");
                                onNumber.each(function (indexs, items) {
                                    if ($(items).html() == $(item).attr("data-branch")) {
                                        $(items).parent("td").prev("td").find("input[type='checkbox']").attr("checked", "true");
                                        $(items).parent("td").prev("td").attr("data-old", "old");
                                    }
                                })
                            })
                        }
                        form.render();
                    })

                }else if(result.code!=200){
                    return false;
                }
            }
        })
    };

    /*打开团队产品*/
    function openTeam(obj) {
        var gettpl = $('#teamProduct').html();
        var spec_uuid = $(obj).parents('.teamProduct').siblings('.layui-col-md10').find('.spec_uuid').val();

        layer.confirm(gettpl, {
            skin: 'my-skin'
            , btn: ['确定'] //按钮
            , title: '查看价格'
            , btnAlign: 'c' //按钮居中
            , area: ['1200px', '490px']
            , shadeClose: true,
            scrollbar: false,
            yes:function(index, layero){
                $('#teamProductTable').find('tr').each(function (index, item) {
                    //teamPriceList[index].currency_id = $(item).find('.currency_id').val();
                    teamPriceList[index].customer_price = $(item).find('.customer_price').val();
                    teamPriceList[index].distributor_price = $(item).find('.distributor_price').val();
                });
                if (teamPriceList)
                {
                    $.ajax({
                        type: "post",
                        url: "/ota_product/updateTeamAjax",
                        data:{
                            teamPriceList:teamPriceList
                        },
                        dataType: "json",
                        success: function (result) {
                            if(result.code==200){

                            }else if(result.code!=200){
                                return false;
                            }
                        }
                    });
                }

                layer.closeAll();
            },
            success:function () {

                if (spec_uuid)
                {
                    $.ajax({
                        type: "post",
                        url: "/ota_product/getTeamAjax",
                        data:{
                            spec_uuid:spec_uuid
                        },
                        dataType: "json",
                        success: function (result) {
                            if(result.code==200){
                                teamPriceList = result.data;
                                var tableList=$("#teamProductTr").html();
                                for (var i=0; i<teamPriceList.length; i++)
                                {
                                    teamPriceList[i].currency = curreys;
                                }
                                laytpl(tableList).render(teamPriceList, function(html) {
                                    $("#teamProductTable").html(html);
                                });
                                form.render();
                            }else if(result.code!=200){
                                return false;
                            }
                        }
                    });
                }

            }
        }, function () {

            form.render();
        });

    }

    function openSource(obj) {
        var gettpl = $('#teamSource').html();
        var spec_uuid = $(obj).parents('.teamProduct').siblings('.layui-col-md10').find('.spec_uuid').val();

        layer.confirm(gettpl, {
            skin: 'my-skin'
            , btn: ['确定'] //按钮
            , title: '查看价格'
            , btnAlign: 'c' //按钮居中
            , area: ['1200px', '490px']
            , shadeClose: true,
            scrollbar: false,
            yes:function(index, layero){
                $('#teamSourceTable').find('tr').each(function (index, item) {
                    //sourcePriceList[index].currency_id = $(item).find('.currency_id').val();
                    sourcePriceList[index].customer_price = $(item).find('.customer_price').val();
                    sourcePriceList[index].distributor_price = $(item).find('.distributor_price').val();
                });
                if (sourcePriceList)
                {
                    $.ajax({
                        type: "post",
                        url: "/ota_product/updateSourceAjax",
                        data:{
                            sourcePriceList:sourcePriceList
                        },
                        dataType: "json",
                        success: function (result) {
                            if(result.code==200){

                            }else if(result.code!=200){
                                return false;
                            }
                        }
                    });
                }

                layer.closeAll();
            },
            success:function () {
                $.ajax({
                    type: "post",
                    url: "/ota_product/getSourceAjax",
                    data:{
                        spec_uuid:spec_uuid
                    },
                    dataType: "json",
                    success: function (result) {
                        if(result.code==200){
                            sourcePriceList = result.data;
                            var tableList=$("#teamSourceTr").html();
                            for (var i=0; i<sourcePriceList.length; i++)
                            {
                                sourcePriceList[i].currency = curreys;
                            }
                            laytpl(tableList).render(sourcePriceList, function(html) {
                                $("#teamSourceTable").html(html);
                            });
                            form.render();
                        }else if(result.code!=200){
                            return false;
                        }
                    }
                });

            }
        }, function () {
            form.render();
        });

    }

    layui.use('layedit', function(){
        var layedit = layui.layedit;

        layedit.set({
            uploadImage: {
                url: '/demo/uploadFile'
                ,type: 'post'
            }
        });

        UE.getEditor('demo3');
        UE.getEditor('demo1');
        UE.getEditor('demo2');
        UE.getEditor('demo4');
    });


</script>


<script>
    layui.use('element', function(){
        var $ = layui.jquery
            ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

        //触发事件
        var active = {
            tabAdd: function(){
                //新增一个Tab项
                element.tabAdd('demo', {
                    title: '规格' //用于演示
                    ,content: $('#t_spec').html()
                    ,id: new Date().getTime() //实际使用一般是规定好的id，这里以时间戳模拟下
                })
            }
            ,tabDelete: function(othis){
                //删除指定Tab项
                element.tabDelete('demo', '44'); //删除：“商品管理”
                othis.addClass('layui-btn-disabled');
            }
            ,tabChange: function(){
                //切换到指定Tab项
                element.tabChange('demo', '22'); //切换到：用户管理
            }
        };

        $('.site-demo-active').on('click', function(){
            var othis = $(this), type = othis.data('type');
            active[type] ? active[type].call(this, othis) : '';
        });

    });


    $('#pool').on('click', function(){

        $.ajax({
            url:'/ota_media_pool/getMediaPoolListAjax',
            type:"post",
            dataType:"json",
            success: function (data) {
                console.log(data.data);
                var list=data.data;
                var html='';
                if(list){
                    for(var i = 0, len = list.length; i < len; i++)
                    {
                        html += '<img src=" '+list[i].url+ '" height="300" width="200" onclick="qq(this)"/>'
                    }
                }
                layer.open({
                    type: 1,
                    area: ['1200px', '900px'],
                    shadeClose: true, //点击遮罩关闭
                    content: html
                });
            }

        });

    });

    function qq(aaa){

        layer.closeAll();
        var h = '<div style="padding: 5px;width: 110px;float: left" class="img_list"><div><img src="'+$(aaa).attr("src")+'" height="100" width="100" /><input type="hidden" value="'+$(aaa).attr("src")+'" name="info[image_urls][]" /></div><div><a class="layui-btn nav-edit delUpload">{$language_tag.index_public_del}</a></div></div>';
        $('#files').append(h);
    }


    $('#poolMap').on('click', function(){

        $.ajax({
            url:'/ota_media_pool/getMediaPoolListAjax',
            type:"post",
            dataType:"json",
            success: function (data) {
                console.log(data.data);
                var list=data.data;
                var html='';
                if(list){
                    for(var i = 0, len = list.length; i < len; i++)
                    {
                        html += '<img src=" '+list[i].url+ '" height="300" width="200" onclick="qq2(this)"/>'
                    }
                }
                layer.open({
                    type: 1,
                    area: ['1200px', '900px'],
                    shadeClose: true, //点击遮罩关闭
                    content: html
                });
            }

        });

    });

    function qq2(aaa){

        layer.closeAll();
        var h = '<div style="padding: 5px;width: 110px;float: left" class="img_list"><div><img src="'+$(aaa).attr("src")+'" height="100" width="100" /><input type="hidden" value="'+$(aaa).attr("src")+'" name="info[image_urls][]" /></div><div><a class="layui-btn nav-edit delUpload">{$language_tag.index_public_del}</a></div></div>';
        $('#filesMap').append(h);
    }

</script>


</body>
</html>
